---
title: "SFA2 - DOC analysis"
author: "Cassandra Wattenburger"
date: "1/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = "show")
```

**Goal of this script:** Analyze DOC data from SFA2.

```{r}
rm(list=ls())

library(tidyverse)
require(broom)
library(lmerTest)
```

# Import DOC data

```{r}
# Import data
doc = readRDS("data_DOC/SFA2/SFA2_doc.rds") %>%
  mutate(sample_id = as.numeric(sample_id)) %>%
  select(sample_id, "doc"=mean)

# Import metadata
meta = read.csv("data_DOC/SFA2/SFA2_doc_metadata.csv")

# Merge
doc.meta = full_join(meta, doc, by=c("Sample" = "sample_id"))

# Sample means
```

# Visualize

```{r}
ggplot(doc.meta, aes(x=as.factor(Innoculant), y=doc, color=DOC_pheno)) +
  geom_point() +
  facet_wrap(~Group) +
  theme_test() +
  labs(x="Sample", y="DOC conc.")

ggplot(doc.meta, aes(x=DOC_pheno, y=doc)) +
  geom_boxplot() +
  facet_wrap(~Group) +
  theme_test() +
  labs(x="Sample", y="DOC conc.")
```

# Statistics

Test separately for headspace and growth experiments.

**Headspace microcosms**

Linear mixed effects model to allow innoculant to be random effect.

```{r}
headspace.doc = filter(doc.meta, Group=="Headspace" & Type=="Sample")
head.doc.lmer = lmer(doc ~ DOC_pheno + (1|Innoculant), data = headspace.doc) # linear mixed effects model, allow innoculant to vary independently
hist(residuals(head.doc.lmer))
plot(residuals(head.doc.lmer), predict(head.doc.lmer))
summary(head.doc.lmer)
```

**Growth**

Linear mixed effects model to allow innoculant to be random effect.

```{r}
growth.doc = filter(doc.meta, Group=="Growth" & Type=="Sample")
grow.doc.lmer = lmer(log(doc) ~ DOC_pheno + (1|Innoculant), data = growth.doc) # linear mixed effects model, allow innoculant to vary independently
hist(residuals(grow.doc.lmer))
plot(residuals(grow.doc.lmer), predict(grow.doc.lmer))
summary(head.doc.lmer)
```


# DOC vs CO2

Is there a relationship between DOC and CO2?

```{r}
# Import CO2 data
co2 = readRDS("data_CO2/SFA2/SFA2_CO2.rds") %>%
  rename(DOC_pheno = DOC_predict)

doc.co2 = full_join(headspace.doc, co2, by=c("Sample", "Innoculant", "DOC_pheno"))
```

**Visualize**

```{r}
doc.co2 %>%
  filter(DOC_pheno != "NA") %>%
  ggplot(aes(x=doc, y=totalCO2mg)) +
  geom_point(aes(color=DOC_pheno)) +
  geom_smooth(method="lm") +
  theme_test()
```

No relationship between DOC and CO2.

# DOC vs protein

Assessing to check that the starting volume of innoculant did not affect DOC outcome. Making sure the protein measurement allowed us to control for starting biomass.

```{r}
# Import protein metadata
prot = read_csv("~/SFAgrowthrate/protein_extractions/SFA1_washprotein_metadata.csv")
head.doc.prot = left_join(headspace.doc, prot, by=c("Innoculant"="Sample"))
```

**Visualize**

```{r}
doc.prot %>% 
  ggplot(aes(x=Volume, y=doc)) +
  geom_point() +
  geom_smooth(method="lm") +
  theme_test()
```

No clear relationship.