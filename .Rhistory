# Prepare data
growth_slim <- growth %>%
select(Inoculant, ASV, slope, yint, k, start_day, end_day, n16S)
growth_norm <- norm %>%
filter(Type=="Growth") %>%
select(Inoculant, Day, ASV, norm_abund) %>%
inner_join(growth_slim) %>%
mutate(norm_abund_corr = norm_abund/n16S, # normalized abundance corrected
g = log(2)/k) %>%  # generation time
select(Inoculant, Day, ASV, start_day, end_day, slope, yint, g, norm_abund_corr, n16S) %>%
group_by(Inoculant, ASV, Day, slope, yint, g, start_day, end_day, n16S) %>%
summarize(norm_abund_corr = mean(norm_abund_corr)) %>% # average replicate values
ungroup() %>%
mutate(group = if_else(start_day <= 9 & end_day <= 9, "group 1", "group 2"))
# Check for problematic 0s for taxa on start of growth
impute_start <- growth_norm %>%
mutate(label = paste0(Inoculant, "_", ASV),
impute = if_else(Day==start_day & norm_abund_corr==0, "impute", # mark for imputation if 0 at start
if_else(Day!=start_day, "NA", "no impute"))) %>%
filter(impute=="impute")
impute_start
# none
# Check for 0s on day 9 (shift between exp and stationary)
impute_day9 <- growth_norm %>%
mutate(label = paste0(Inoculant, "_", ASV),
impute = if_else(Day==9 & norm_abund_corr==0, "impute", # mark for imputation if 0 at start
if_else(Day!=start_day, "NA", "no impute"))) %>%
filter(impute=="impute" & group=="group 2")
impute_day9
# Seems like a lot 79/131 (where day 9 = 0 abund), I'll impute all using the slope of the original linear model
# TROUBLESHOOT this seems high?
ls
head(growth_norm)
growth_impute <- growth_norm %>%
filter(group == "group 2" & Day==9) %>%
mutate(impute_lnabund = slope*9 + yint,
impute_abund = exp(impute_lnabund),
impute_abund_corr = impute_abund/n16S)
head(growth_impute)
growth_x <- growth_impute %>%
full_join(growth_norm) %>%
mutate(norm_abund_corr = if_else(Day==9 & norm_abund_corr==0, impute_abund_corr, norm_abund_corr)) # impute
head(growth_x)
growth_x <- growth_impute %>%
full_join(growth_norm) %>%
mutate(norm_abund_corr = if_else(Day==9 & norm_abund_corr==0, impute_abund_corr, norm_abund_corr)) %>% # impute
select(Inoculant, ASV, Day, start_day, end_day, norm_abund_corr)
head(growth_x)
View(growth_x)
filter(growth_x, Day==9) %>% View()
growth_impute <- growth_norm %>%
filter(group == "group 2" & Day==9) %>%
mutate(impute_lnabund = slope*9 + yint,
impute_abund = exp(impute_lnabund),
impute_abund_corr = impute_abund/n16S) %>%
full_join(growth_norm) %>%
mutate(norm_abund_corr = if_else(Day==9 & norm_abund_corr==0, impute_abund_corr, norm_abund_corr)) %>% # impute
select(Inoculant, ASV, Day, start_day, end_day, norm_abund_corr)
head(growth_impute)
# Group 1
exp_gain1 <- filter(growth_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of growth (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>% # gained during growth
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
head(exp_gain1)
filter(growth_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of growth (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>%View()
# Group 2
exp_gain2 <- filter(growth_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/g) - norm_abund_corr) %>% # gained prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
exp_gain2
filter(growth_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/g) - norm_abund_corr)
filter(growth_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/g) - norm_abund_corr) %>% View()
# Group 2
stat_gain1 <- filter(growth_impute, end_day >= 9 & start_day <= 9) %>% # started growing in exponential
filter(Day==9) %>% # starting abundnace will be abundance on day 9
mutate(deltaN = norm_abund_corr*2^((end_day-9)/g) - norm_abund_corr) %>% # gained after day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
growth_impute <- growth_norm %>%
filter(group == "group 2" & Day==9) %>%
mutate(impute_lnabund = slope*9 + yint,
impute_abund = exp(impute_lnabund),
impute_abund_corr = impute_abund/n16S) %>%
full_join(growth_norm) %>%
mutate(norm_abund_corr = if_else(Day==9 & norm_abund_corr==0, impute_abund_corr, norm_abund_corr)) %>% # impute
select(Inoculant, ASV, Day, start_day, end_day, g, norm_abund_corr)
# Group 2
stat_gain1 <- filter(growth_impute, end_day >= 9 & start_day <= 9) %>% # started growing in exponential
filter(Day==9) %>% # starting abundnace will be abundance on day 9
mutate(deltaN = norm_abund_corr*2^((end_day-9)/g) - norm_abund_corr) %>% # gained after day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
stat_gain1
# Group 3
stat_gain2 <- filter(growth_norm, end_day >= 9 & start_day >= 9) %>% # started growing in stationary
filter(Day==start_day) %>% # abundance at start of growth
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>%
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) %>% # add missing incoulants (no observed estiamtes)
add_row(Inoculant="19", deltaN=0)
stat_gain2
filter(growth_norm, end_day >= 9 & start_day >= 9) %>% # started growing in stationary
filter(Day==start_day) %>% # abundance at start of growth
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>% View()
# Exponential phase
# Group 1
exp_gain1 <- filter(growth_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of growth (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>% # gained during growth
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 2
exp_gain2 <- filter(growth_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/g) - norm_abund_corr) %>% # gained prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Stationary phase
# Group 2
stat_gain1 <- filter(growth_impute, end_day >= 9 & start_day <= 9) %>% # started growing in exponential
filter(Day==9) %>% # starting abundnace will be abundance on day 9
mutate(deltaN = norm_abund_corr*2^((end_day-9)/g) - norm_abund_corr) %>% # gained after day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 3
stat_gain2 <- filter(growth_norm, end_day >= 9 & start_day >= 9) %>% # started growing in stationary
filter(Day==start_day) %>% # abundance at start of growth
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>%
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) %>% # add missing incoulants (no observed estiamtes)
add_row(Inoculant="19", deltaN=0)
# Combine
expstat_gain <- bind_cols(exp_gain1, exp_gain2) %>%
bind_cols(stat_gain1) %>%
bind_cols(stat_gain2) %>%
select(Inoculant=`Inoculant...1`, deltaN_exp1=`deltaN...2`, deltaN_exp2=`deltaN...4`, deltaN_stat=`deltaN...6`) %>%
mutate(deltaN_exp = deltaN_exp1 + deltaN_exp2)
expstat_gain %>%
summarize(exp_mean = mean(deltaN_exp),
exp_sd = sd(deltaN_exp),
stat_mean = mean(deltaN_stat),
stat_sd = sd(deltaN_stat))
# Check for problematic 0s for taxa on start of death
impute_start <- death_norm %>%
mutate(label = paste0(Inoculant, "_", ASV),
impute = if_else(Day==start_day & norm_abund_corr==0, "impute", # mark for imputation if 0 at start
if_else(Day!=start_day, "NA", "no impute"))) %>%
filter(impute=="impute")
# Prepare data
death_slim <- death %>%
select(Inoculant, ASV, slope, yint, k, start_day, end_day, n16S)
death_norm <- norm %>%
filter(Type=="death") %>%
select(Inoculant, Day, ASV, norm_abund) %>%
inner_join(death_slim) %>%
mutate(norm_abund_corr = norm_abund/n16S, # normalized abundance corrected
g = log(2)/k) %>%  # generation time
select(Inoculant, Day, ASV, start_day, end_day, slope, yint, h, norm_abund_corr, n16S) %>%
group_by(Inoculant, ASV, Day, slope, yint, h, start_day, end_day, n16S) %>%
summarize(norm_abund_corr = mean(norm_abund_corr)) %>% # average replicate values
ungroup() %>%
mutate(group = if_else(start_day <= 9 & end_day <= 9, "group 1", "group 2"))
# Prepare data
death_slim <- death %>%
select(Inoculant, ASV, slope, yint, k, start_day, end_day, n16S)
death_norm <- norm %>%
filter(Type=="Growth") %>%
select(Inoculant, Day, ASV, norm_abund) %>%
inner_join(death_slim) %>%
mutate(norm_abund_corr = norm_abund/n16S, # normalized abundance corrected
g = log(2)/k) %>%  # generation time
select(Inoculant, Day, ASV, start_day, end_day, slope, yint, h, norm_abund_corr, n16S) %>%
group_by(Inoculant, ASV, Day, slope, yint, h, start_day, end_day, n16S) %>%
summarize(norm_abund_corr = mean(norm_abund_corr)) %>% # average replicate values
ungroup() %>%
mutate(group = if_else(start_day <= 9 & end_day <= 9, "group 1", "group 2"))
head(death_slim)
# Prepare data
death_slim <- death %>%
select(Inoculant, ASV, slope, yint, k, h, start_day, end_day, n16S)
head(death)
# Prepare data
death_slim <- death %>%
select(Inoculant, ASV, slope, yint, k, h, start_day, end_day, n16S)
# Prepare data
death_slim <- death %>%
select(Inoculant, ASV, slope, yint, k, start_day, end_day, n16S)
death_norm <- norm %>%
filter(Type=="Growth") %>%
select(Inoculant, Day, ASV, norm_abund) %>%
inner_join(death_slim) %>%
mutate(norm_abund_corr = norm_abund/n16S, # normalized abundance corrected
h = log(2)/k) %>%  # generation time
select(Inoculant, Day, ASV, start_day, end_day, slope, yint, h, norm_abund_corr, n16S) %>%
group_by(Inoculant, ASV, Day, slope, yint, h, start_day, end_day, n16S) %>%
summarize(norm_abund_corr = mean(norm_abund_corr)) %>% # average replicate values
ungroup() %>%
mutate(group = if_else(start_day <= 9 & end_day <= 9, "group 1", "group 2"))
head(death_norm)
# Check for problematic 0s for taxa on start of death
impute_start <- death_norm %>%
mutate(label = paste0(Inoculant, "_", ASV),
impute = if_else(Day==start_day & norm_abund_corr==0, "impute", # mark for imputation if 0 at start
if_else(Day!=start_day, "NA", "no impute"))) %>%
filter(impute=="impute")
impute_start
# none
# Check for 0s on day 9 (shift between exp and stationary)
impute_day9 <- death_norm %>%
mutate(label = paste0(Inoculant, "_", ASV),
impute = if_else(Day==9 & norm_abund_corr==0, "impute", # mark for imputation if 0 at start
if_else(Day!=start_day, "NA", "no impute"))) %>%
filter(impute=="impute" & group=="group 2")
impute_day9
# Seems like a lot 79/131 (where day 9 = 0 abund), I'll impute all using the slope of the original linear model
# TROUBLESHOOT this seems high?
death_impute <- death_norm %>%
filter(group == "group 2" & Day==9) %>%
mutate(impute_lnabund = slope*9 + yint,
impute_abund = exp(impute_lnabund),
impute_abund_corr = impute_abund/n16S) %>%
full_join(death_norm) %>%
mutate(norm_abund_corr = if_else(Day==9 & norm_abund_corr==0, impute_abund_corr, norm_abund_corr)) %>% # impute
select(Inoculant, ASV, Day, start_day, end_day, g, norm_abund_corr)
death_impute <- death_norm %>%
filter(group == "group 2" & Day==9) %>%
mutate(impute_lnabund = slope*9 + yint,
impute_abund = exp(impute_lnabund),
impute_abund_corr = impute_abund/n16S) %>%
full_join(death_norm) %>%
mutate(norm_abund_corr = if_else(Day==9 & norm_abund_corr==0, impute_abund_corr, norm_abund_corr)) %>% # impute
select(Inoculant, ASV, Day, start_day, end_day, h, norm_abund_corr)
death(impute)
head(death_impute)
# Exponential phase
# Group 1
exp_gain1 <- filter(death_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of death (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>% # gained during death
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Exponential phase
# Group 1
exp_gain1 <- filter(death_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of death (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/h) - norm_abund_corr) %>% # gained during death
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 2
exp_gain2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # gained prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Stationary phase
# Group 2
stat_gain1 <- filter(death_impute, end_day >= 9 & start_day <= 9) %>% # started growing in exponential
filter(Day==9) %>% # starting abundnace will be abundance on day 9
mutate(deltaN = norm_abund_corr*2^((end_day-9)/h) - norm_abund_corr) %>% # gained after day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 3
stat_gain2 <- filter(death_norm, end_day >= 9 & start_day >= 9) %>% # started growing in stationary
filter(Day==start_day) %>% # abundance at start of death
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/g) - norm_abund_corr) %>%
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) %>% # add missing incoulants (no observed estiamtes)
add_row(Inoculant="19", deltaN=0)
# Exponential phase
# Group 1
exp_gain1 <- filter(death_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of death (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/h) - norm_abund_corr) %>% # gained during death
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 2
exp_gain2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # gained prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Stationary phase
# Group 2
stat_gain1 <- filter(death_impute, end_day >= 9 & start_day <= 9) %>% # started growing in exponential
filter(Day==9) %>% # starting abundnace will be abundance on day 9
mutate(deltaN = norm_abund_corr*2^((end_day-9)/h) - norm_abund_corr) %>% # gained after day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 3
stat_gain2 <- filter(death_norm, end_day >= 9 & start_day >= 9) %>% # started growing in stationary
filter(Day==start_day) %>% # abundance at start of death
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/h) - norm_abund_corr) %>%
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) %>% # add missing incoulants (no observed estiamtes)
add_row(Inoculant="19", deltaN=0)
# Combine
expstat_gain <- bind_cols(exp_gain1, exp_gain2) %>%
bind_cols(stat_gain1) %>%
bind_cols(stat_gain2) %>%
select(Inoculant=`Inoculant...1`, deltaN_exp1=`deltaN...2`, deltaN_exp2=`deltaN...4`, deltaN_stat=`deltaN...6`) %>%
mutate(deltaN_exp = deltaN_exp1 + deltaN_exp2)
bind_cols(exp_gain1, exp_gain2) %>%
bind_cols(stat_gain1) %>%
bind_cols(stat_gain2) %>% View()
bind_cols(exp_gain1, exp_gain2) %>%
bind_cols(stat_gain1) %>%
bind_cols(stat_gain2)
exp_gain1
exp_gain2
# Exponential phase
# Group 1
exp_loss1 <- filter(death_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of death (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/h) - norm_abund_corr) %>% # lossed during death
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 2
exp_loss2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # lossed prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Stationary phase
# Group 2
stat_loss1 <- filter(death_impute, end_day >= 9 & start_day <= 9) %>% # started growing in exponential
filter(Day==9) %>% # starting abundnace will be abundance on day 9
mutate(deltaN = norm_abund_corr*2^((end_day-9)/h) - norm_abund_corr) %>% # lossed after day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 3
stat_loss2 <- filter(death_norm, end_day >= 9 & start_day >= 9) %>% # started growing in stationary
filter(Day==start_day) %>% # abundance at start of death
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/h) - norm_abund_corr) %>%
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) %>% # add missing incoulants (no observed estiamtes)
add_row(Inoculant="19", deltaN=0)
# Combine
expstat_loss <- bind_cols(exp_loss1, exp_loss2) %>%
bind_cols(stat_loss1) %>%
bind_cols(stat_loss2) %>%
select(Inoculant=`Inoculant...1`, deltaN_exp1=`deltaN...2`, deltaN_exp2=`deltaN...4`, deltaN_stat=`deltaN...6`) %>%
mutate(deltaN_exp = deltaN_exp1 + deltaN_exp2)
exp_loss1
exp_loss2
stat_loss1
stat_loss1
stat_loss2
exp_los2
exp_loss2
# Group 2
exp_loss2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # lossed prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant=41, deltaN=0) # inlcude inoculants with no estimates here
# Group 2
exp_loss2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # lossed prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant==41, deltaN==0) # inlcude inoculants with no estimates here
exp_loss2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # lossed prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
exp_loss2
?add_row
# Group 2
exp_loss2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # lossed prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant=41, deltaN=0) # inlcude inoculants with no estimates here
# Group 2
exp_loss2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # lossed prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) # inlcude inoculants with no estimates here
exp_stat2
exp_loss2
stat_loss1
stat_loss2
# Exponential phase
# Group 1
exp_loss1 <- filter(death_norm, end_day <= 9) %>% # grew only during exponential
filter(start_day==Day) %>% # use abundance at start of death (N0)
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/h) - norm_abund_corr) %>% # lossed during death
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
# Group 2
exp_loss2 <- filter(death_norm, end_day >= 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/h) - norm_abund_corr) %>% # lossed prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) # inlcude inoculants with no estimates here
# Stationary phase
# Group 2
stat_loss1 <- filter(death_impute, end_day >= 9 & start_day <= 9) %>% # started growing in exponential
filter(Day==9) %>% # starting abundnace will be abundance on day 9
mutate(deltaN = norm_abund_corr*2^((end_day-9)/h) - norm_abund_corr) %>% # lossed after day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) # inlcude inoculants with no estimates here
# Group 3
stat_loss2 <- filter(death_norm, end_day >= 9 & start_day >= 9) %>% # started growing in stationary
filter(Day==start_day) %>% # abundance at start of death
mutate(deltaN = norm_abund_corr*2^((end_day-start_day)/h) - norm_abund_corr) %>%
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup() %>%
add_row(Inoculant="41", deltaN=0) %>% # add missing incoulants (no observed estiamtes)
add_row(Inoculant="19", deltaN=0)
# Combine
expstat_loss <- bind_cols(exp_loss1, exp_loss2) %>%
bind_cols(stat_loss1) %>%
bind_cols(stat_loss2) %>%
select(Inoculant=`Inoculant...1`, deltaN_exp1=`deltaN...2`, deltaN_exp2=`deltaN...4`, deltaN_stat=`deltaN...6`) %>%
mutate(deltaN_exp = deltaN_exp1 + deltaN_exp2)
expstat_loss %>%
summarize(exp_mean = mean(deltaN_exp),
exp_sd = sd(deltaN_exp),
stat_mean = mean(deltaN_stat),
stat_sd = sd(deltaN_stat))
expstat_loss
# Combine gains and losses
expstat_gain2 <- expstat_gain %>%
select(Inoculant, deltaN_exp, deltaN_stat) %>%
pivot_longer(cols=!Inoculant, names_to="phase", values_to="deltaN") %>%
mutate(phase = gsub("deltaN_", "", phase),
type="growth")
expstat_loss2 <- expstat_loss %>%
select(Inoculant, deltaN_exp, deltaN_stat) %>%
pivot_longer(cols=!Inoculant, names_to="phase", values_to="deltaN") %>%
mutate(phase = gsub("deltaN_", "", phase),
type="death")
expstat_gainloss <- bind_rows(expstat_gain2, expstat_loss2)
# Plot
expstat_gainloss %>%
ggplot(aes(x=phase, y=log(deltaN), color=type)) +
geom_boxplot() +
theme_test()
# Group 2
exp_gain2 <- filter(growth_norm, end_day > 9 & start_day <= 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/g) - norm_abund_corr) %>% # gained prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
exP_gain2
exp_gain2
# Group 2
exp_gain2 <- filter(growth_norm, end_day => 9 & start_day < 9) %>% # grew after exponential too
# Group 2
exp_gain2 <- filter(growth_norm, end_day >= 9 & start_day < 9) %>% # grew after exponential too
filter(start_day==Day) %>% # starting abundance at start day
mutate(deltaN = norm_abund_corr*2^((9-start_day)/g) - norm_abund_corr) %>% # gained prior to day 9
group_by(Inoculant) %>%
summarize(deltaN = sum(deltaN)) %>%
ungroup()
exp_gain2
