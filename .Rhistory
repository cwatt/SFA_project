getwd()
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = "show")
rm(list=ls())
library(plyr)
library(tidyverse)
require(broom)
library(reshape2)
library(qqplotr)
library(car)
# Import data
doc = read.csv("~/SFAgrowthrate/DOC_data/SFA1.5/SFA1.5_DOCsummary.csv")
# Import data
doc = read.csv("DOC_data/SFA1.5/SFA1.5_DOCsummary.csv")
# Import data
doc = read.csv("data_DOC/SFA1.5/SFA1.5_DOCsummary.csv")
# Import metadata
meta=read.csv("data_DOC/SFA1.5_DOC_metadata.csv")
# Import data
doc = read.csv("data_DOC/SFA1.5/SFA1.5_DOCsummary.csv")
# Import metadata
meta = read.csv("data_DOC/SFA1.5/SFA1.5_DOC_metadata.csv")
# Add metadata
doc.meta = merge(meta, doc, by.y="Sample.ID", by.x="ucosm", all=TRUE)
doc.meta = doc.meta[,-c(5,7)]
# Sample means
doc.mean = ddply(doc.meta, .(Sample,DOC), summarize, sample.mean = mean(mean), sample.stdv = sd(mean))
# Visualize
ggplot(doc.meta, aes(x=as.factor(Sample), y=mean, color=DOC)) +
geom_boxplot(aes(group=Sample)) +
geom_point() +
theme_test() +
labs(x="Sample", y="DOC conc.")
ggplot(doc.meta, aes(x=DOC, y=mean, color=DOC)) +
geom_boxplot(aes(group=DOC)) +
geom_point() +
theme_test() +
labs(x="Sample", y="DOC conc. (replicates)")
ggplot(doc.mean, aes(x=DOC, y=sample.mean, color=DOC)) +
geom_boxplot(aes(group=DOC)) +
geom_point() +
theme_test() +
labs(x="Sample", y="DOC conc. (sample avgs)") +
geom_smooth(method="lm")
# Student's t-test
doc.test = t.test(sample.mean ~ DOC, data=doc.mean[which(doc.meta$DOC=="high" | doc.meta$DOC=="low"),])
lm(sample.mean ~ DOC, data=doc.mean[which(doc.meta$DOC=="high" | doc.meta$DOC=="low"),])
print(paste("High vs low DOC producing communities: p-value =", doc.test$p.value))
ggplot()
plot(resid(doc.test))
# Student's t-test
doc.test = t.test(sample.mean ~ DOC, data=doc.mean[which(doc.meta$DOC=="high" | doc.meta$DOC=="low"),])
plot(resid(doc.test))
class(doc.test)
# Student's t-test
doc.test = t.test(sample.mean ~ DOC, data=doc.mean[which(doc.meta$DOC=="high" | doc.meta$DOC=="low"),], var.equal=TRUE)
plot(resid(doc.test))
lm(sample.mean ~ DOC, data=doc.mean[which(doc.meta$DOC=="high" | doc.meta$DOC=="low"),])
doc.lm = lm(sample.mean ~ DOC, data=doc.mean[which(doc.meta$DOC=="high" | doc.meta$DOC=="low"),])
plot(resid())
plot(resid(doc.lm))
hist(resid(doc.lm))
plot(predict(doc.lm), resid(doc.lm))
summary(doc.lm)
doc.test = t.test(sample.mean ~ DOC, data=doc.mean[which(doc.meta$DOC=="high" | doc.meta$DOC=="low"),], var.equal=TRUE)
summary(doc.test)
doc.test$p.value
summary(doc.lm)
# SFA 1 data
load("~/SFAgrowthrate/data_DOC/SFA1/SFA1_DOC.data.RData")
# SFA 1 data
load("data_DOC/SFA1/SFA1_DOC.data.RData")
# SFA 1 data
load("r.objects/SFA1/SFA1_DOC.data.RData")
# SFA 1 data
load("r.objects/SFA1_DOC.data.RData")
# Summarize replicates
data.melt=melt(DOC.data[,c(2,3,6)], id.vars=c("s.type","Soil.sample"))
data.smry=ddply(data.melt, c("Soil.sample","s.type"), summarize, avg=mean(value), stdv=sd(value))
# Isolate samples from phase 1
sfa1.doc = data.smry[data.smry$Soil.sample %in% as.character(doc.mean$Sample),]
sfa1.doc = sfa1.doc[,c(1,3:4)]
colnames(sfa1.doc) = c("Sample", "mean","stdv")
sfa1.doc = cbind(sfa1.doc, phase=rep("SFA1", nrow(sfa1.doc)))
# Reformat phase 1.5 data
sfa1.5.doc = doc.mean[,c(1,3:4)]
colnames(sfa1.5.doc) = c("Sample","mean","stdv")
sfa1.5.doc = cbind(sfa1.5.doc, phase=rep("SFA1.5", nrow(sfa1.5.doc)))
# Merge phases
both.doc = rbind(sfa1.doc, sfa1.5.doc)
highlow = doc.mean[,c(1:2)] # add DOC rank
both.doc = merge(both.doc, highlow)
avg.hi = mean(both.doc[both.doc$DOC=="high",]$mean)
avg.lo = mean(both.doc[both.doc$DOC=="low",]$mean)
# Visualize
ggplot(both.doc, aes(x=Sample, y=mean, shape=phase, color=DOC)) +
geom_point() +
geom_errorbar(aes(ymin=mean-stdv, ymax=mean+stdv), width=0.5) +
geom_hline(yintercept=avg.hi, color="#F8766D", linetype=2) +
geom_hline(yintercept=avg.lo, color="#7CAE00", linetype=2) +
scale_y_continuous(limits=c(0,4000)) +
theme_test() +
labs(y="DOC conc.")
# Mean DOC
both.doc.noctrl = both.doc[!both.doc$Sample==51,]
both.doc2 = as.data.frame(cbind(sample=both.doc.noctrl[both.doc.noctrl$phase=="SFA1",]$Sample, sfa1=both.doc.noctrl[both.doc.noctrl$phase=="SFA1",]$mean, sfa1.5=both.doc.noctrl[both.doc.noctrl$phase=="SFA1.5",]$mean))
both.doc2 = cbind(both.doc2, DOC=both.doc.noctrl[both.doc.noctrl$phase=="SFA1",]$DOC) # not sure why I couldn't put this in above
# Visualize
ggplot(both.doc2, aes(x=sfa1, y=sfa1.5)) +
geom_point(aes(shape=DOC)) +
geom_smooth(method="lm", linetype=2) +
geom_abline(intercept=0, slope=1, linetype=2) +
scale_x_continuous(limits=c(0,1600)) +
scale_y_continuous(limits=c(0,1600)) +
theme_test() +
theme(legend.position = c(0.1, 0.8)) +
labs(title="Mean DOC conc.", x="experiment 1", y="experiment 2")
# Standard deviation DOC
both.doc3 = as.data.frame(cbind(sample=both.doc.noctrl[both.doc.noctrl$phase=="SFA1",]$Sample, sfa1=both.doc.noctrl[both.doc.noctrl$phase=="SFA1",]$stdv, sfa1.5=both.doc.noctrl[both.doc.noctrl$phase=="SFA1.5",]$stdv))
both.doc3 = cbind(both.doc3, DOC=both.doc.noctrl[both.doc.noctrl$phase=="SFA1",]$DOC)
# Visualize
ggplot(both.doc3, aes(x=sfa1, y=sfa1.5)) +
geom_point(aes(shape=DOC)) +
geom_smooth(method="lm", linetype=2) +
geom_abline(intercept=0, slope=1, linetype=2) +
scale_x_continuous(limits=c(0,500)) +
scale_y_continuous(limits=c(0,500)) +
theme_test() +
theme(legend.position = c(0.1, 0.8)) +
labs(title="Standard dev. DOC conc.", x="experiment 1", y="experiment 2")
test.avg = lm(sfa1 ~ sfa1.5, both.doc2)
print("Mean DOC conc. SFA1 vs SFA1.5:")
summary(test.avg)
print("Stdev DOC conc. SFA1 vs SFA1.5:")
test.stdev = lm(sfa1 ~ sfa1.5, both.doc3)
summary(test.stdev)
# Subtract mean of SFA1 from SFA1.5
diff.doc = both.doc %>% group_by(phase) %>% mutate(diff = mean - lag(mean, default=first(mean)))
diff.doc = diff.doc[c(2,4,6,8,10,12,14,16,18,20,22,24,26),c(1,5:6)]
diff.doc$diff = abs(diff.doc$diff)
diff.ord = arrange(diff.doc, diff)
diff.ord
# Least variable samples
chosen.doc = doc.mean[doc.mean$Sample %in% c(19,47,2,10,12,41),]
# Visualize
ggplot(chosen.doc, aes(x=as.factor(Sample), y=sample.mean, color=DOC)) +
geom_point() +
geom_errorbar(aes(ymin=sample.mean-sample.stdv, ymax=sample.mean+sample.stdv), width=0.5) +
theme_test() +
labs(y="DOC conc.", x="Sample")
heaad(doc.meta)
head(doc.meta)
chosenind.doc = filter(doc.meta, Sample %in% c(19,47,2,10,12,41))
heaad(chosenind.doc)
head(chosenind.doc)
docchosen.lm = lm(mean ~ DOC, data=chosenind.doc[which(chosenind.doc$DOC=="high" | chosenind.doc$DOC=="low"),])
hist(resid(dochcosen.lm)) # assess normality of fit
hist(resid(docchosen.lm)) # assess normality of fit
plot(predict(chosenind.doc), resid(chosenind.doc))
plot(predict(chosenind.lm), resid(chosenind.lm))
plot(predict(docchosen.lm), resid(docchosen.lm))
plot(predict(docchosen.lm), resid(docchosen.lm)) # assess equal variances
hist(resid(docchosen.lm)) # assess normality of fit
docchosen.lm = lm(log(mean) ~ DOC, data=chosenind.doc[which(chosenind.doc$DOC=="high" | chosenind.doc$DOC=="low"),])
hist(resid(docchosen.lm)) # assess normality of fit
plot(predict(docchosen.lm), resid(docchosen.lm)) # assess equal variances
summary(docchosen.lm)
prot.meta = read.csv("~/SFAgrowthrate/SFAphase1/protein_extractions/SFA1_washprotein_metadata.csv")
prot.meta = read.csv("~/SFAgrowthrate/protein_extractions/SFA1_washprotein_metadata.csv")
doc.prot = merge(doc.mean, prot.meta)
ggplot(doc.prot, aes(x=sample.mean, Protein)) +
geom_point() +
theme_test() +
labs(x="DOC conc.", "Protein conc.")
ggplot(doc.prot, aes(x=sample.mean, Volume)) +
geom_point() +
theme_test() +
labs(x="DOC conc.", "Wash volume")
ggplot(doc.prot, aes(x=sample.mean, Protein)) +
geom_point() +
geom_smooth() +
theme_test() +
labs(x="DOC conc.", "Protein conc.")
ggplot(doc.prot, aes(x=sample.mean, Protein)) +
geom_point() +
geom_smooth(method="lm") +
theme_test() +
labs(x="DOC conc.", "Protein conc.")
ggplot(doc.prot, aes(x=sample.mean, Volume)) +
geom_point() +
geom_smooth(method="lm") +
theme_test() +
labs(x="DOC conc.", "Wash volume")
