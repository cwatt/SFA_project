---
title: "SFA2 - meltcurve troubleshoot"
author: "Cassandra Wattenburger"
date: "6/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r}
rm(list=ls())

library(tidyverse)

sessionInfo()
```

Some of the meltcurves on PCRs are very high. Want to see if this is systematic based on experimental design. Could indicate that too much internal standard was added.

Import data
-----------

Melt curve data and DNA concentration data.

```{r}
melt <- read_csv("../data_qPCR/SFA2_meltcurve_troubleshoot.csv")
dna <- read_csv("../data_picogreen/SFA2_dnaspikes.csv")

melt_dna <- left_join(melt, dna) %>%
  mutate(melt_curve, melt_curve = if_else(melt_curve==2, "high", if_else(melt_curve==1, "intermediate", "normal")),
         melt_curve = as_factor(melt_curve),
         melt_curve = fct_relevel(melt_curve, c("normal", "intermediate", "high")))
```

In melt$melt_curve, 0 means normal, 1 means inbetween, and 2 means high.

Investigate
-----------

```{r}
ggplot(melt_dna, aes(x=AdjConc, y=melt_curve, color=melt_curve)) +
  geom_jitter() +
  labs(x="DNA concentraion (ng/uL)", y="Melt curve temp.") +
  theme_test()
```

Definitely a relationship between DNA concentration and melt curve temp.

```{r}
ggplot(melt_dna, aes(x=spike_group, y=melt_curve, color=melt_curve)) +
  geom_jitter() +
  labs(x="Spike-in level", y="Melt curve temp.") +
  theme_test()
```

```{r}
ggplot(melt_dna, aes(x=Day, y=melt_curve, color=melt_curve)) +
  geom_jitter() +
  geom_vline(xintercept = 7) +
  labs(x="Day", y="Melt curve temp.") +
  theme_test()
```


Percent spike in high vs normal meltcurves
------------------------------------------

Calculating percent of total DNA the spike comprises in each sample.

```{r}
melt_dna <- melt_dna %>% 
  mutate(spike_total = if_else(spike_group == "low", 0.034, 0.171),
         dna_total = AdjConc*1000*15,
         spike_perc = (spike_total/(dna_total+spike_total)*100))

melt_dna %>%
  ggplot(aes(x=Day, y=spike_perc, color=melt_curve)) +
  geom_jitter() +
  labs(x="Day", y="% spike-in") +
  theme_test()

melt_dna %>%
  ggplot(aes(x=melt_curve, y=spike_perc, color=melt_curve)) +
  geom_jitter() +
  labs(x="Melt curve", y="% spike-in") +
  theme_test()
  
```

There doesn't seem to be a strict cut off for when the melt-curve becomes reliably high based on spike-in %... I was hoping there would be.

Most of the "normal" melt curves lie below 0.0005% of the total DNA. Maybe that is a good target?




